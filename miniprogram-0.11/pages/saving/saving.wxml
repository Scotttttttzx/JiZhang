<!--pages/saving/saving.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨æ€»å­˜é’±å¡ç‰‡ -->
  <view class="total-saving-card">
    <view class="total-saving-header">
      <text class="total-saving-label">æ€»å­˜é’±é‡‘é¢</text>
      <text class="total-saving-value">Â¥{{totalSaved}}</text>
    </view>
    <view class="total-saving-subtitle">
      <text>å…±{{savingGoals.length}}ä¸ªå­˜é’±ç›®æ ‡</text>
    </view>
  </view>

  <!-- å­˜é’±ç›®æ ‡åŒºåŸŸ -->
  <view class="goals-section">
    <view class="section-header">
      <text class="section-title">å­˜é’±ç›®æ ‡</text>
      <view class="add-goal-btn" bindtap="onShowAddGoalModal">
        <text class="add-icon">+</text>
        <text class="add-text">æ·»åŠ ç›®æ ‡</text>
      </view>
    </view>
    
    <view class="goals-list">
      <block wx:if="{{savingGoals.length === 0}}">
        <view class="no-goals">
          <text class="no-goals-icon">ğŸ’°</text>
          <text class="no-goals-text">æš‚æ— å­˜é’±ç›®æ ‡</text>
          <text class="no-goals-desc">ç‚¹å‡»ä¸Šæ–¹"æ·»åŠ ç›®æ ‡"å¼€å§‹æ‚¨çš„å­˜é’±è®¡åˆ’</text>
        </view>
      </block>
      <block wx:else>
        <view class="goal-item" 
              wx:for="{{savingGoals}}" 
              wx:key="id"
              bindtap="onGoalDetail"
              data-goal="{{item}}">
          <view class="goal-left">
            <view class="goal-icon" style="background-color: {{item.type.color}}">
              <text>{{item.type.icon}}</text>
            </view>
            <view class="goal-info">
              <text class="goal-name">{{item.name}}</text>
              <text class="goal-progress">Â¥{{item.currentAmount}} / Â¥{{item.targetAmount}}</text>
              <text class="goal-deadline" wx:if="{{item.deadline}}">æˆªæ­¢: {{item.deadline}}</text>
            </view>
          </view>
          <view class="goal-right">
            <view class="goal-actions">
              <view class="action-btn save-btn" 
                    catchtap="onShowAddRecordModal" 
                    data-goal-id="{{item.id}}">
                <text>å­˜é’±</text>
              </view>
              <view class="action-btn delete-btn" 
                    catchtap="onDeleteGoal" 
                    data-goal="{{item}}">
                <text>åˆ é™¤</text>
              </view>
            </view>
          </view>
        </view>
      </block>
    </view>
  </view>

  <!-- æœ€è¿‘å­˜é’±è®°å½• -->
  <view class="records-section">
    <view class="section-header">
      <text class="section-title">æœ€è¿‘å­˜é’±è®°å½•</text>
    </view>
    
    <view class="records-list">
      <block wx:if="{{savingRecords.length === 0}}">
        <view class="no-records">
          <text class="no-records-text">æš‚æ— å­˜é’±è®°å½•</text>
        </view>
      </block>
      <block wx:else>
        <view class="record-item" 
              wx:for="{{savingRecords.slice(0, 5)}}" 
              wx:key="id">
          <view class="record-left">
            <text class="record-icon">ğŸ’°</text>
            <view class="record-info">
              <text class="record-goal">{{item.goalName}}</text>
              <text class="record-remark" wx:if="{{item.remark}}">{{item.remark}}</text>
              <text class="record-time">{{item.createTime}}</text>
            </view>
          </view>
          <view class="record-right">
            <text class="record-amount">+Â¥{{item.amount.toFixed(2)}}</text>
          </view>
        </view>
      </block>
    </view>
  </view>

  <!-- æ·»åŠ ç›®æ ‡å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showAddGoalModal}}" bindtap="onHideAddGoalModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">æ·»åŠ å­˜é’±ç›®æ ‡</text>
        <view class="modal-close" bindtap="onHideAddGoalModal">
          <text>Ã—</text>
        </view>
      </view>
      
      <view class="modal-body">
        <view class="form-item">
          <text class="form-label">ç›®æ ‡åç§°</text>
          <input class="form-input" 
                 placeholder="è¯·è¾“å…¥ç›®æ ‡åç§°" 
                 value="{{newGoal.name}}"
                 bindinput="onGoalNameInput" />
        </view>
        
        <view class="form-item">
          <text class="form-label">ç›®æ ‡é‡‘é¢</text>
          <view class="amount-input-wrapper">
            <text class="currency">Â¥</text>
            <input class="amount-input" 
                   type="digit" 
                   placeholder="0.00" 
                   value="{{newGoal.targetAmount}}"
                   bindinput="onGoalAmountInput" />
          </view>
        </view>
        
        <view class="form-item">
          <text class="form-label">æˆªæ­¢æ—¥æœŸ</text>
          <picker mode="date" 
                  value="{{newGoal.deadline}}" 
                  bindchange="onGoalDeadlineChange">
            <view class="picker-input">
              <text wx:if="{{newGoal.deadline}}">{{newGoal.deadline}}</text>
              <text wx:else class="placeholder">é€‰æ‹©æˆªæ­¢æ—¥æœŸï¼ˆå¯é€‰ï¼‰</text>
            </view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">å¤‡æ³¨</text>
          <input class="form-input" 
                 placeholder="æ·»åŠ å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰" 
                 value="{{newGoal.remark}}"
                 bindinput="onGoalRemarkInput" />
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="cancel-btn" bindtap="onHideAddGoalModal">å–æ¶ˆ</button>
        <button class="confirm-btn" bindtap="onAddGoal">ç¡®å®š</button>
      </view>
    </view>
  </view>

  <!-- æ·»åŠ å­˜é’±è®°å½•å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showAddRecordModal}}" bindtap="onHideAddRecordModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">æ·»åŠ å­˜é’±è®°å½•</text>
        <view class="modal-close" bindtap="onHideAddRecordModal">
          <text>Ã—</text>
        </view>
      </view>
      
      <view class="modal-body">
        <view class="form-item">
          <text class="form-label">å­˜é’±é‡‘é¢</text>
          <view class="amount-input-wrapper">
            <text class="currency">Â¥</text>
            <input class="amount-input" 
                   type="digit" 
                   placeholder="0.00" 
                   value="{{newRecord.amount}}"
                   bindinput="onRecordAmountInput" />
          </view>
        </view>
        
        <view class="form-item">
          <text class="form-label">å¤‡æ³¨</text>
          <input class="form-input" 
                 placeholder="æ·»åŠ å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰" 
                 value="{{newRecord.remark}}"
                 bindinput="onRecordRemarkInput" />
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="cancel-btn" bindtap="onHideAddRecordModal">å–æ¶ˆ</button>
        <button class="confirm-btn" bindtap="onAddRecord">ç¡®å®š</button>
      </view>
    </view>
  </view>
</view> 