<!--pages/saving-detail/saving-detail.wxml-->
<view class="container">
  <!-- ç›®æ ‡ä¿¡æ¯å¡ç‰‡ -->
  <view class="goal-card" wx:if="{{goal}}">
    <view class="goal-header">
      <view class="goal-icon" style="background-color: {{goal.type.color}}">
        <text>{{goal.type.icon}}</text>
      </view>
      <view class="goal-info">
        <text class="goal-name">{{goal.name}}</text>
        <text class="goal-remark" wx:if="{{goal.remark}}">{{goal.remark}}</text>
      </view>
      <view class="goal-actions">
        <view class="action-btn edit-btn" bindtap="onEditGoal">
          <text>ç¼–è¾‘</text>
        </view>
        <view class="action-btn delete-btn" bindtap="onDeleteGoal">
          <text>åˆ é™¤</text>
        </view>
      </view>
    </view>
    
    <view class="goal-progress-section">
      <view class="goal-details">
        <view class="detail-item">
          <text class="detail-label">ç›®æ ‡é‡‘é¢</text>
          <text class="detail-value">Â¥{{goal.targetAmount}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">å·²å­˜é‡‘é¢</text>
          <text class="detail-value">Â¥{{goal.currentAmount}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">å‰©ä½™é‡‘é¢</text>
          <text class="detail-value">Â¥{{goal.remainingAmount}}</text>
        </view>
        <view class="detail-item" wx:if="{{goal.deadline}}">
          <text class="detail-label">æˆªæ­¢æ—¥æœŸ</text>
          <text class="detail-value">{{goal.deadline}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å­˜é’±è®°å½•åŒºåŸŸ -->
  <view class="records-section">
    <view class="section-header">
      <text class="section-title">å­˜é’±è®°å½•</text>
      <view class="add-record-btn" bindtap="onShowAddRecordModal">
        <text class="add-icon">+</text>
        <text class="add-text">å­˜é’±</text>
      </view>
    </view>
    
    <view class="records-list">
      <block wx:if="{{records.length === 0}}">
        <view class="no-records">
          <text class="no-records-icon">ğŸ’°</text>
          <text class="no-records-text">æš‚æ— å­˜é’±è®°å½•</text>
          <text class="no-records-desc">ç‚¹å‡»ä¸Šæ–¹"å­˜é’±"å¼€å§‹æ‚¨çš„å­˜é’±è®¡åˆ’</text>
        </view>
      </block>
      <block wx:else>
        <view class="record-item" 
              wx:for="{{records}}" 
              wx:key="id">
          <view class="record-left">
            <text class="record-icon">ğŸ’°</text>
            <view class="record-info">
              <text class="record-amount">+Â¥{{item.amount}}</text>
              <text class="record-remark" wx:if="{{item.remark}}">{{item.remark}}</text>
              <text class="record-time">{{item.createTime}}</text>
            </view>
          </view>
          <view class="record-right">
            <view class="delete-record-btn" 
                  catchtap="onDeleteRecord" 
                  data-record="{{item}}">
              <text>åˆ é™¤</text>
            </view>
          </view>
        </view>
      </block>
    </view>
  </view>

  <!-- æ·»åŠ å­˜é’±è®°å½•å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showAddRecordModal}}" bindtap="onHideAddRecordModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">æ·»åŠ å­˜é’±è®°å½•</text>
        <view class="modal-close" bindtap="onHideAddRecordModal">
          <text>Ã—</text>
        </view>
      </view>
      
      <view class="modal-body">
        <view class="form-item">
          <text class="form-label">å­˜é’±é‡‘é¢</text>
          <view class="amount-input-wrapper">
            <text class="currency">Â¥</text>
            <input class="amount-input" 
                   type="digit" 
                   placeholder="0.00" 
                   value="{{newRecord.amount}}"
                   bindinput="onRecordAmountInput" />
          </view>
        </view>
        
        <view class="form-item">
          <text class="form-label">å¤‡æ³¨</text>
          <input class="form-input" 
                 placeholder="æ·»åŠ å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰" 
                 value="{{newRecord.remark}}"
                 bindinput="onRecordRemarkInput" />
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="cancel-btn" bindtap="onHideAddRecordModal">å–æ¶ˆ</button>
        <button class="confirm-btn" bindtap="onAddRecord">ç¡®å®š</button>
      </view>
    </view>
  </view>
</view> 